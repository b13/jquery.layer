/**
 * layer plugin
 *
 * (c) 2013 b:dreizehn, Germany
 * Author: Daniel Sattler
 *
 * This plugin provides an easy way to include a fullscreen layer on a website.
 *
 * The content of the layer is loaded via ajax. The url for the ajax request can 
 * be stored inside the "data-layercontenturl" attribute of the element or passed throw
 * this plugin over the "ajaxUrl" option.
 *
 * Make sure to setup the right width over the "layerWidth" option on init the plugin.
 * This is important to center the layer. Your customized styling for the layer has to be done 
 * in your own css - start with styling your layer at the wrapping div of your layer content 
 * (which is loaded over ajax), also give this div a background-color.
 *
 *
 * HOOKS:
 * To extend the plugin the following hooks are available:
 * 
 *  "open"   : before layer will be opened
 *  "opened" : after layer is opened
 *  "close"  : before layer will be closed
 *  "closed" : after the layer is closed
 *
 * the hooks can be used like this:
 *
 * $(elem).on('open', function() {
 *   // do some stuff before the layer will be opened
 * });
 *
 */

(function(e,t,n,r){e.layer=function(t,n){var r=this,i={},s=false,o="",u="",a="",f="";r.init=function(){r.el=t;r.$el=e(t);i=r.options=e.extend({},e.layer.defaults,n);r.createHtml();return r};r.createHtml=function(){u=e("#"+i.layerID);a=e("#"+i.layerBgID);f=e("#"+i.loadingGifID);o=e("#"+i.layerContainerID);if(o.length==0){e("body").append("<div id='"+i.layerContainerID+"'></div>");o=e("#"+i.layerContainerID);o.hide().css(i.css.layerContainerID);o.append("<div id='"+i.layerID+"'></div>");u=e("#"+i.layerID);u.hide().css(i.css.layerID);if(i.showLoadingGif){o.append("<div id='"+i.loadingGifID+"'><img src='"+i.pathToLoadingGif+"'></div>");f=e("#"+i.loadingGifID);f.hide().css(i.css.loadingGifID)}}if(a.length==0){e("body").append("<div id='"+i.layerBgID+"'></div>");a=e("#"+i.layerBgID);a.hide().css(i.css.layerBgID)}};r.events=function(){o.off("click").on("click",function(t){if(e(this).find(t.target).length==0){r.$el.trigger("close");r.closeLayer()}});e("."+i.closeLayerClassName).off("click").on("click",function(e){e.preventDefault();r.$el.trigger("close");r.closeLayer()})};r.getAjaxContent=function(t){if(i.ajaxUrl.length>0){var n=i.ajaxUrl}else{var n=r.$el.data(i.dataNameForAjaxUrl)}e.ajax({url:n,cache:false}).done(function(e){r.loadingGif.hide();u.append(e);r.layer.show();r.$el.trigger("opened");if(t){t(this)}}).fail(function(){console.log("fail to load ajax content")})};r.background={settings:{bodyStyle:""},show:function(t){var n=this;n.settings.bodyStyle=e("body").attr("style");e("body").css({position:"relative",overflow:"hidden"});a.show();if(t){t(this)}},hide:function(t){var n=this;e("body").removeAttr("style").attr("style",n.settings.bodyStyle);a.hide();if(t){t(this)}}};r.loadingGif={show:function(e){f.show();if(e){e(this)}},hide:function(e){f.hide();if(e){e(this)}}};r.layer={show:function(e){u.css({width:i.layerWidth,"margin-left":"-"+i.layerWidth/2+"px"});u.show();if(e){e(this)}},hide:function(e){u.hide();if(e){e(this)}}};r.container={show:function(e){o.show();if(e){e(this)}},hide:function(e){o.hide();if(e){e(this)}}};r.closeLayer=function(){r.container.hide();r.background.hide();r.loadingGif.hide();r.layer.hide();u.children().remove();s=false;r.$el.trigger("closed")};r.openLayer=function(){if(s){return}s=true;r.$el.trigger("open");r.events();r.container.show();r.background.show();if(i.showLoadingGif){r.loadingGif.show()}r.getAjaxContent()};r.init()};e.layer.defaults={showLoadingGif:true,pathToLoadingGif:"/typo3conf/templates/main/img/ajax-loader.gif",closeLayerClassName:"amazingLayer-close",dataNameForAjaxUrl:"layercontenturl",ajaxUrl:"",layerWidth:"600",layerContainerID:"amazingLayer-container",layerID:"amazingLayer-box",layerBgID:"amazingLayer-bg",loadingGifID:"amazingLayer-loadingGif",css:{layerContainerID:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px","z-index":"99995",overflow:"scroll"},loadingGifID:{position:"absolute",left:"50%",top:"50%","z-index":"99999"},layerID:{position:"absolute",left:"50%"},layerBgID:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px","z-index":"99990",opacity:"0.7",background:"black"}}};e.fn.layer=function(t){return this.each(function(){var n=e(this),r=n.data("layer");if(!r){n.data("layer",r=new e.layer(this,t))}else{switch(t){case"open":r.openLayer();break;case"close":r.closeLayer();break}}})}})(jQuery,window,document)